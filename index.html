<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High-Performance Text Comparison</title>
    <script>
        // Myersアルゴリズムの差分計算
        function myersDiff(a, b) {
            const m = a.length, n = b.length;
            const max = m + n;
            const v = Array(2 * max + 1).fill(0);
            const trace = [];

            for (let d = 0; d <= max; d++) {
                trace.push([...v]);
                for (let k = -d; k <= d; k += 2) {
                    let x = 0;
                    if (k === -d || (k !== d && v[k - 1 + max] < v[k + 1 + max])) {
                        x = v[k + 1 + max];
                    } else {
                        x = v[k - 1 + max] + 1;
                    }
                    let y = x - k;

                    while (x < m && y < n && a[x] === b[y]) {
                        x++;
                        y++;
                    }

                    v[k + max] = x;
                    if (x >= m && y >= n) {
                        return trace;
                    }
                }
            }
        }

        // 差分ハイライト生成
        function generateHighlightedDiff(a, b, trace) {
            let x = a.length, y = b.length;
            let resultA = '', resultB = '';

            for (let d = trace.length - 1; d >= 0; d--) {
                const v = trace[d];
                const k = x - y;
                const prevK = (k === -d || (k !== d && v[k - 1 + v.length / 2] < v[k + 1 + v.length / 2]))
                    ? k + 1
                    : k - 1;
                const prevX = v[prevK + v.length / 2];
                const prevY = prevX - prevK;

                while (x > prevX && y > prevY) {
                    resultA = a[--x] + resultA;
                    resultB = b[--y] + resultB;
                }

                if (x > prevX) {
                    resultA = `<span class="highlight-deleted">${a[--x]}</span>` + resultA;
                } else if (y > prevY) {
                    resultB = `<span class="highlight-added">${b[--y]}</span>` + resultB;
                }
            }

            while (x > 0) {
                resultA = `<span class="highlight-deleted">${a[--x]}</span>` + resultA;
            }
            while (y > 0) {
                resultB = `<span class="highlight-added">${b[--y]}</span>` + resultB;
            }

            return { highlightedA: resultA, highlightedB: resultB };
        }

        // テキスト比較
        function compareTexts() {
            const text1 = document.getElementById("text1").value.trim();
            const text2 = document.getElementById("text2").value.trim();

            const trace = myersDiff(text1, text2);
            const { highlightedA, highlightedB } = generateHighlightedDiff(text1, text2, trace);

            document.getElementById("output1").innerHTML = highlightedA;
            document.getElementById("output2").innerHTML = highlightedB;
        }
    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        textarea {
            width: 45%;
            height: 300px;
            margin-bottom: 10px;
        }

        .output {
            width: 45%;
            height: 300px;
            overflow: auto;
            padding: 10px;
            border: 1px solid #ddd;
            background: #f9f9f9;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .highlight-added {
            background-color: #d4edda;
            color: #155724;
            font-weight: bold;
        }

        .highlight-deleted {
            background-color: #f8d7da;
            color: #721c24;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <h1>High-Performance Text Comparison</h1>
    <div style="display: flex; justify-content: space-between;">
        <textarea id="text1" placeholder="テキスト1を入力してください"></textarea>
        <textarea id="text2" placeholder="テキスト2を入力してください"></textarea>
    </div>
    <button onclick="compareTexts()">比較する</button>
    <div style="display: flex; justify-content: space-between; margin-top: 20px;">
        <div id="output1" class="output"></div>
        <div id="output2" class="output"></div>
    </div>
</body>

</html>
